(()=>{"use strict";document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("connectPhantom"),t=document.getElementById("connectSolflare"),o=document.getElementById("statusMessage"),n=document.getElementById("walletAddress"),l=!!window.phantom?.solana?.isPhantom,a=!!window.solflare;function s(e,t=!1){o.textContent=e,o.style.display="block",o.className=t?"status error":"status success"}async function c(e){try{const t=(await e.connect()).publicKey.toString();if(s("Successfully connected!"),n.textContent=t,n.style.display="block","undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.id)try{chrome.runtime.sendMessage({action:"walletConnected",publicKey:t},function(e){chrome.runtime.lastError?(console.error("Error sending message to extension:",chrome.runtime.lastError),localStorage.setItem("solanaWalletPublicKey",t)):(console.log("Message sent directly to extension:",e),setTimeout(()=>{window.close()},2e3))})}catch(e){console.error("Failed to send message directly to extension:",e),localStorage.setItem("solanaWalletPublicKey",t)}else{console.log("Using localStorage to pass wallet address to extension"),localStorage.setItem("solanaWalletPublicKey",t);try{window.postMessage({type:"WALLET_CONNECTED",publicKey:t},"*")}catch(e){console.error("Error posting message:",e)}}s("Connected! You can close this tab and return to the extension.");const o=document.createElement("button");o.textContent="Close This Tab",o.style.padding="10px 20px",o.style.marginTop="20px",o.style.backgroundColor="#0070f3",o.style.color="white",o.style.border="none",o.style.borderRadius="4px",o.style.cursor="pointer",o.addEventListener("click",()=>window.close());const l=document.querySelector(".container");return l&&l.appendChild(o),t}catch(e){return console.error("Error connecting wallet:",e),s(e.message||"Failed to connect wallet",!0),null}}l||(e.disabled=!0,e.textContent="Phantom Not Installed"),a||(t.disabled=!0,t.textContent="Solflare Not Installed"),e.addEventListener("click",async function(){const t=window.phantom?.solana;t?(e.disabled=!0,e.textContent="Connecting...",await c(t),e.disabled=!1,e.textContent="Connect Phantom Wallet"):s("Phantom wallet not found. Please install it first.",!0)}),t.addEventListener("click",async function(){const e=window.solflare;e?(t.disabled=!0,t.textContent="Connecting...",await c(e),t.disabled=!1,t.textContent="Connect Solflare Wallet"):s("Solflare wallet not found. Please install it first.",!0)});const i=window.isSecureContext,r="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;if(!i&&!r){s("Warning: Phantom requires HTTPS or localhost for wallet connections. Wallet detection may fail.",!0);const e=document.querySelector(".wallet-buttons");e&&(e.style.opacity="0.5")}l&&window.phantom?.solana&&window.phantom.solana.on("accountChanged",e=>{e?(console.log(`Switched to account ${e.toBase58()}`),n.textContent=e.toBase58(),n.style.display="block",localStorage.setItem("solanaWalletPublicKey",e.toBase58())):console.log("Switched to an account that is not connected to this app")})})})();